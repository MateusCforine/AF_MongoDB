<h1>Gestor Financeiro Pessoal</h1>

<section class="form">
  <h2>Nova movimentação</h2>

  <!-- Chama o método criar() do TS quando o formulário é enviado -->
  <form (ngSubmit)="criar()">
    <div>
      <label>Tipo</label>
      <!-- ngModel ligado à variável 'tipo' no TS -->
      <select [(ngModel)]="tipo" name="tipo">
        <option value="receita">Receita</option>
        <option value="despesa">Despesa</option>
      </select>
    </div>

    <div>
      <label>Categoria</label>
      <input [(ngModel)]="categoria" name="categoria" required />
    </div>

    <div>
      <label>Descrição</label>
      <input [(ngModel)]="descricao" name="descricao" required />
    </div>

    <div>
      <label>Valor</label>
      <input
        type="number"
        step="0.01"
        [(ngModel)]="valor"
        name="valor"
        required
      />
    </div>

    <div>
      <label>Data</label>
      <input type="date" [(ngModel)]="data" name="data" required />
    </div>

    <button type="submit" [disabled]="salvando">Salvar</button>
  </form>
</section>

<section class="lista">
  <h2>Movimentações</h2>

  <!-- @if substituindo *ngIf -->
  @if (carregando) {
    <p>Carregando...</p>
  }

  @if (erro) {
    <p>{{ erro }}</p>
  }

  @if (!carregando && movimentacoes.length === 0) {
    <p>Nenhuma movimentação cadastrada.</p>
  }

  @if (movimentacoes.length > 0) {
    <table>
      <thead>
        <tr>
          <th>Data</th>
          <th>Tipo</th>
          <th>Categoria</th>
          <th>Descrição</th>
          <th>Valor</th>
          <th></th>
        </tr>
      </thead>

      <tbody>
        <!-- @for substituindo *ngFor -->
        @for (m of movimentacoes; track m._id) {
          <tr
            [class.receita]="m.tipo === 'receita'"
            [class.despesa]="m.tipo === 'despesa'"
          >
            <td>{{ m.data | date: 'dd/MM/yyyy' }}</td>
            <td>{{ m.tipo }}</td>
            <td>{{ m.categoria }}</td>
            <td>{{ m.descricao }}</td>
            <td>{{ m.valor | currency:'BRL':'symbol' }}</td>

            <td>
              <button type="button" (click)="excluir(m)">Excluir</button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  }

  @if (movimentacoes.length > 0) {
    <div class="saldo">
      Saldo:
      <span [class.positivo]="saldo >= 0" [class.negativo]="saldo < 0">
        {{ saldo | currency:'BRL':'symbol' }}
      </span>
    </div>
  }
</section>
